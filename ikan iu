DELIMITER $$

CREATE PROCEDURE calculateTotalLoanedBooksValue(
    OUT totalValue INT
)
BEGIN
    SELECT 
        SUM(b.tarif_denda_harian * d.jumlah)
    INTO totalValue
    FROM detail_pinjaman d
    INNER JOIN buku b ON d.id_buku = b.id_buku
    INNER JOIN peminjaman p ON d.id_peminjaman = p.id_peminjaman
    WHERE p.tanggal_kembali IS NULL;
END $$

DELIMITER ;
