[10/12 14.59] Lucass: DELIMITER $$

CREATE FUNCTION getProductPrice(pCode INT)
RETURNS DECIMAL(10,2)
DETERMINISTIC
BEGIN
    DECLARE hasil DECIMAL(10,2);

    SELECT price INTO hasil
    FROM Products
    WHERE productCode = pCode;

    RETURN hasil;
END$$

DELIMITER ;
[10/12 14.59] Lucass: DELIMITER $$

CREATE FUNCTION supplierCountByCountry(pCountry VARCHAR(50))
RETURNS INT
DETERMINISTIC
BEGIN
    DECLARE total INT;

    SELECT COUNT(*)
    INTO total
    FROM Suppliers
    WHERE country = pCountry;

    RETURN total;
END$$

DELIMITER ;
[10/12 14.59] Lucass: DELIMITER $$

CREATE PROCEDURE listProductsBySupplier(
    IN pSupplierID INT,
    INOUT productList TEXT
)
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE pName VARCHAR(100);
    DECLARE pStock INT;

    DECLARE cur CURSOR FOR
        SELECT P.productName, P.stock
        FROM Products P
        JOIN ProductSupplies PS ON P.productCode = PS.productCode
        WHERE PS.supplierID = pSupplierID;

    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;

    OPEN cur;

    read_loop: LOOP
        FETCH cur INTO pName, pStock;
        IF done = 1 THEN
            LEAVE read_loop;
        END IF;

        SET productList = CONCAT(productList,
                                 pName, ' - ', pStock, '; ');
    END LOOP;

    CLOSE cur;
END$$

DELIMITER ;    DECLARE done INT DEFAULT FALSE;
    DECLARE pName VARCHAR(100);
    DECLARE pStock INT;

    -- Mendefinisikan cursor
    DECLARE product_cursor CURSOR FOR
        SELECT p.productName, ps.stock
        FROM end_pt_products p
        JOIN end_pt_product_supplies ps ON p.productCode = ps.productCode
        WHERE ps.supplierID = sID;

    -- Mendefinisikan handler untuk not found (akhir dari cursor)
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;

    -- Mengosongkan productList sebelum memulai
    SET productList = '';

    OPEN product_cursor;

    -- Loop untuk mengambil data dari cursor
    read_loop: LOOP
        FETCH product_cursor INTO pName, pStock;
        IF done THEN
            LEAVE read_loop;
        END IF;

        -- Menggabungkan nama produk dan stok ke dalam productList
        SET productList = CONCAT(productList, pName, ' - ', pStock, '; ');
    END LOOP read_loop;

    CLOSE product_cursor;
END $$
DELIMITER ;



